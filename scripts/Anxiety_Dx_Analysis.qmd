---
title: "ADAPT Treatment Effect on Anxiety Diagnosis"
subtitle: "Client: Lucy Nguyen. CSTAT Case: C1593"
author: 
  - name: Steven J. Pierce
    orcid: 0000-0002-0679-3019
    email: pierces1@msu.edu
    affiliations: 
      - name: Michigan State University, Center for Statistical Training and Consulting
params:
  SourceDir: "scripts/"
  SourceFile: "Anxiety_Dx_Analysis.qmd"
  LogFile: "Anxiety_Dx_Analysis_Draft.html"
bibliography: references.bib
csl: apa.csl
date: now
date-modified: last-modified
date-format: YYYY-MM-DD HH:mm:ss z
format: 
  html:
    output-file: "Anxiety_Dx_Analysis_Draft.html"
    toc: true
    toc-depth: 3
    toc-location: left
    number-sections: true
    number-depth: 3
    code-fold: true
    code-tools: true
    code-line-numbers: false
    embed-resources: true 
    anchor-sections: true
    theme: default
execute: 
  eval: true 
  echo: fenced 
  output: true 
  message: true 
  warning: true 
  error: true 
  include: true 
---

# Overview
This file contains results of statistical analyses performed by a 
[CSTAT](https://cstat.msu.edu) statistician for a project called 
*Effects of How Mental Health Diagnosis in Pediatric Patients with Functional Abdominal Pain Disorders Respond to Cognitive Behavioral Therapy Specifically for Anxiety Symptoms*, 
which was tracked by CSTAT as Case C1593. The original data come from one of 
Dr. Natoshia Cunningham's grants. Lucy is one of Dr. Cunningham's students. The
study was a randomized controlled trial of a tailored cognitive behavioral
therapy (CBT) treatment for functional abdominal pain in pediatric patients that
was called ADAPT [@Cunningham-RN8194]. The control group received treatment as 
usual (TAU).

# Setup
Most readers will want to just skip to @sec-Descriptive. This section is mostly
useful to the statistician who ran the analyses as methods and reproducibility 
documentation.

## Declare Path
This next chunk declares the path to this script relative to the project-level 
root directory. If the file is not in the right location under the project root
you'll get a warning message. This helps ensure relative paths are all working 
as expected. 

``` {r}
#| label: declare-path

# Declare path to this script relative to the project root directory.
here::i_am(path = paste0(params$SourceDir, params$SourceFile))
```

Note that `here()` creates a path relative to the location of the 
`ADAPT_Anxiety.Rproj` file that will be portable across different computers.
That's why we use that function when specifying file paths throughout the
script.

## Load Packages

```{r}
#| label: load-packages
#| include: true

library(devtools)     # for session_info()
library(here)         # for here() and i_am(), handling relative file paths. 
library(rmarkdown)    # for pandoc_version()
library(knitr)        # for kable()
options(kableExtra.latex.load_packages = FALSE)
library(kableExtra)   # for kable_styling() and formatting tables. 
library(tidyverse)    # Loads the dplyr, forcats, ggplot2, lubridate, purrr, 
                      # readr, stringr, tibble, and tidyr packages, for access 
                      # to %>%, select(), mutate(), etc. 
library(piercer)      # for all_classes()
library(janitor)      # for adorn_totals()
library(quarto)       # for quarto_version()
```

## Read in Data
Here we just read in the data we need for the analyses. 

:::{.callout-important}
This script assumes you have already used `scripts/Import_SPSS_data.qmd` to 
create the data file `data/ADAPT_Clean.RData`.
:::

``` {r}
#| label: load-ADAPT-Clean-Data

load(file=here("data/ADAPT_Clean.RData"))
```

The imported `ADAPT_Clean_Data` data frame has `r nrow(ADAPT_Clean_Data)` rows 
and `r ncol(ADAPT_Clean_Data)` variables. @tbl-ADAPT-Clean-variables shows a 
list of the variable positions, names, and classes.

``` {r}
#| label: tbl-ADAPT-Clean-variables
#| tbl-cap: "ADAPT Outcomes Clean Data: Variable Names and Classes."

ADAPT_CleanVars <- list(ADAPT_Clean_Data) %>% 
  map_dfr(~ tibble(Name = names(.x), Class = map_chr(.x, all_classes))) %>% 
  rowid_to_column(., "Position")

kable(ADAPT_CleanVars, format = "html", booktabs = TRUE, longtable = TRUE) %>%
  kable_styling(bootstrap_options = "striped", 
                latex_options = c("repeat_header")) 
```

# Descriptive Statistics {#sec-Descriptive}

## Arm
@tbl-Arm-freq shows the frequency distribution of the randomized arm 
allocations. 

```{r}
#| label: tbl-Arm-freq
#| tbl-cap: Number of Patients by Randomized Arm in ADAPT_Clean_Data Data

ADAPT_Clean_Data %>% 
  xtabs(~Arm, addNA = TRUE, data = .) %>% 
  addmargins() %>% 
  as.data.frame() %>% 
  mutate(Type = case_when(Arm == "ADAPT" ~ "Intervention", 
                          Arm == "TAU" ~ "Control",
                          Arm == "Sum" ~ "Intervention + Control")) %>% 
  select(Arm, Type, Freq) %>% 
  kable(format = "html", booktabs = TRUE, 
        col.names = c("Randomized Arm", "Type", "Frequency")) %>% 
  kable_styling(bootstrap_options = "striped") 
```

## Outcomes 

### Generalized Anxiety Disorder (`GAD_Pre`, `GAD_Post`) 

```{r}
#| label: tbl-xtabs-GAD
#| tbl-cap: "Crosstab Diagnosed with GAD at Pretest vs Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(GAD_Pre),
         Dx_Post = addNA(GAD_Post)) %>% 
  group_by(Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", 
        col.names = c("Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  add_indent(1:3) %>% 
  row_spec(row = 4, bold = TRUE) %>% 
  column_spec(column = 5, bold = TRUE) %>% 
  add_header_above(header = c(" ", "Diagnosed at Posttest" = 3, " "))
```

```{r}
#| label: tbl-GAD-Change
#| tbl-cap: "Change in Diagnosis with GAD Over Time"

ADAPT_Clean_Data %>% 
  mutate(Dx_Change = addNA(GAD_Change)) %>% 
  group_by(Dx_Change, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  mutate(Percent = 100*N/sum(N)) %>% 
  ungroup() %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", digits = 0,
        col.names = c("Diagnosis Change", "N", "%")) %>% 
  kable_styling() %>% 
  row_spec(row = 5, bold = TRUE)
```

I still need to add group-specific total rows to @tbl-xtabs-GAD-Arm. 

```{r}
#| label: tbl-xtabs-GAD-Arm
#| tbl-cap: "Crosstab Diagnosed with GAD at Pretest vs Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(GAD_Pre),
         Dx_Post = addNA(GAD_Post)) %>% 
  group_by(Arm, Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>%   
  group_by(Arm, .drop = FALSE) %>% 
  group_modify(~ .x %>% adorn_totals(where = "row", name = "Sum")) %>%
  kable(format = "html", 
        col.names = c("Arm", "Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  row_spec(row = c(4,8), bold = TRUE) %>% 
  column_spec(column = 6, bold = TRUE) %>% 
  add_header_above(header = c(" " = 2, "Diagnosed at Posttest" = 3, " ")) %>% 
  collapse_rows(columns = 1:2, valign = "top", latex_hline = "major", 
                row_group_label_position = "stack")
```

```

### Social Anxiety Disorder (`Social_Pre`, `Social_Post`)

```{r}
#| label: tbl-xtabs-Social
#| tbl-cap: "Crosstab Diagnosed with Social Anxiety Disorder at Pretest vs at Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(Social_Pre),
         Dx_Post = addNA(Social_Post)) %>% 
  group_by(Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", 
        col.names = c("Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  add_indent(1:3) %>% 
  row_spec(row = 4, bold = TRUE) %>% 
  column_spec(column = 5, bold = TRUE) %>% 
  add_header_above(header = c(" ", "Diagnosed at Posttest" = 3, " "))
```

### Separation Anxiety Disorder (`SAD_Pre`, `SAD_Post`)

```{r}
#| label: tbl-xtabs-SAD
#| tbl-cap: "Crosstab Diagnosed with SAD at Pretest vs Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(SAD_Pre),
         Dx_Post = addNA(SAD_Post)) %>%
  group_by(Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", 
        col.names = c("Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  add_indent(1:3) %>% 
  row_spec(row = 4, bold = TRUE) %>% 
  column_spec(column = 5, bold = TRUE) %>% 
  add_header_above(header = c(" ", "Diagnosed at Posttest" = 3, " "))
```

### Panic Disoder (`Panic_Pre`, `Panic_Post`)

```{r}
#| label: tbl-xtabs-Panic
#| tbl-cap: "Crosstab Diagnosed with Panic Disorder at Pretest vs Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(Panic_Pre),
         Dx_Post = addNA(Panic_Post)) %>%
  group_by(Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", 
        col.names = c("Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  add_indent(1:3) %>% 
  row_spec(row = 4, bold = TRUE) %>% 
  column_spec(column = 5, bold = TRUE) %>% 
  add_header_above(header = c(" ", "Diagnosed at Posttest" = 3, " "))
```

### Obsessive Compusive Disorder (`OCD_Pre`, `OCD_Post`)

```{r}
#| label: tbl-xtabs-OCD
#| tbl-cap: "Crosstab Diagnosed with OCD at Pretest vs Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(OCD_Pre),
         Dx_Post = addNA(OCD_Post)) %>%
  group_by(Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", 
        col.names = c("Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  add_indent(1:3) %>% 
  row_spec(row = 4, bold = TRUE) %>% 
  column_spec(column = 5, bold = TRUE) %>% 
  add_header_above(header = c(" ", "Diagnosed at Posttest" = 3, " "))
```

### Major Depressive Disorder (`MDD_Pre`, `MDD_Post`)

```{r}
#| label: tbl-xtabs-MDD
#| tbl-cap: "Crosstab Diagnosed with MDD at Pretest vs Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(MDD_Pre),
         Dx_Post = addNA(MDD_Post)) %>%
  group_by(Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", 
        col.names = c("Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  add_indent(1:3) %>% 
  row_spec(row = 4, bold = TRUE) %>% 
  column_spec(column = 5, bold = TRUE) %>% 
  add_header_above(header = c(" ", "Diagnosed at Posttest" = 3, " "))
```

### Dysthymia (`Dysthymia_Pre`, `Dysthymia_Post`)

```{r}
#| label: tbl-xtabs-Dysthymia
#| tbl-cap: "Crosstab Diagnosed with OCD at Pretest vs Posttest"

ADAPT_Clean_Data %>% 
  mutate(Dx_Pre = addNA(Dysthymia_Pre),
         Dx_Post = addNA(Dysthymia_Post)) %>%
  group_by(Dx_Pre, Dx_Post, .drop = FALSE) %>% 
  summarise(N = n()) %>% 
  ungroup() %>% 
  pivot_wider(names_from = Dx_Post, names_prefix = "Dx_Post_", 
              values_from = N, values_fill = 0) %>% 
  mutate(Dx_Pre = as.character(Dx_Pre),
         Sum = Dx_Post_0 + Dx_Post_1 + Dx_Post_NA) %>% 
  adorn_totals(where = "row", name = "Sum") %>%
  kable(format = "html", 
        col.names = c("Diagnosed at Pretest", "0", "1", "NA", "Sum")) %>% 
  kable_styling() %>% 
  add_indent(1:3) %>% 
  row_spec(row = 4, bold = TRUE) %>% 
  column_spec(column = 5, bold = TRUE) %>% 
  add_header_above(header = c(" ", "Diagnosed at Posttest" = 3, " "))
```

# References
::: {#refs}
:::

# Software Information
We used [R](https://www.r-project.org/) as our main computing environment and 
[Quarto](https://quarto.org/) scripts to enhance reproducibility. We used 
[RStudio](www.rstudio.org) as the editor to interface with R and Quarto. 

- Software chain:
  **qmd file > RStudio > Quarto > R > knitr > md file > Pandoc > html file**.
- Source file: **`r params$SourceFile`**
- Output file: **`r params$LogFile`**
- [Quarto `r quarto_version()`](https://quarto.org/) runs `*.qmd` files through 
  [R](https://www.r-project.org/) and [knitr](https://yihui.org/knitr/) to 
  produce `*.md` markdown files.
- [Pandoc `r rmarkdown::pandoc_version()`](https://pandoc.org) converts markdown 
  files (`*.md`) to other formats, including LaTeX (`*.tex`) and HTML (`*.html`) 
  among others.

This document was generated using the following computational environment and 
dependencies: 

``` {r}
#| label: show-version
#| echo: true

# Get R and R package version numbers in use.
devtools::session_info()
```

